
<!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">
<head>
<style>
	*{
		 -moz-user-select: none;
   -webkit-user-select: none;
   user-select: none;
	}

	:root{
		--cell_size:30px;
		--cell_border_size: 1px;

	}
	table{
		
		border-collapse: collapse;
		/* display three tables per row*/
		flex: 0 0 33.333333%;
		outline:2px solid black;
		outline-offset: -1.5px;
		padding:2px;


	}
	td{
		width:30px;
		border:var(--cell_border_size) solid black;

		height:30px;
		padding:0;
		text-align: center;
		font-size:calc(var(--cell_size) / 1.75);

	}

	#table_container{
		 display: inline-flex;
		flex-wrap: wrap;
		font-family: sans-serif;
		outline:2px solid black;
		/*1 is the border size for td)*/
		width:calc(calc(var(--cell_size) + var(--cell_border_size)) * 9);
		pos
	

	}
	.center{
		width:100%;
		display: flex;
  justify-content: center;
  position: fixed;
  top:20%;

	}
	
</style>



</head>
<body>
<div class='center'>
<div id='table_container'>

</div>
</div>
<script>
	const table_container = document.querySelector("#table_container");
	const cell_list = [];
	let new_arr = [];

	for(let i = 0; i<9;i++){
		let table = document.createElement("table");
		for(let j=0; j<3;j++){
			let tr = document.createElement("tr");
			for(let b = 0; b<3;b++){
				let td = document.createElement("td");
				tr.appendChild(td);
			}
			table.appendChild(tr)
		}
		table_container.appendChild(table);
	}
	const num_list =[1,2,3,4,5,6,7,8,9];
	function random_assign(arr){
		const new_arr = [];
		// can not directly modify arr because if will modify the original array (num_list)
		const duplicate_arr =JSON.parse(JSON.stringify(arr));
		while(duplicate_arr.length > 0){
			let random_num = Math.floor(Math.random() *  duplicate_arr.length)
			new_arr.push(duplicate_arr[random_num]);
			 duplicate_arr.splice(random_num,1);

		}
		return new_arr;

	}
	function generate_numbers(){
		const array = []; 
		for(let i =0; i < 9;i++){
			//create a 3 * 3 block
				const block = Array.from(Array(3), () => new Array(3));;

				const hor_restricted_row = [...Array(3)].map(e => Array());

				//Math.floor(i/3) * 3 => 0th or 3rd or 6th block
				for(let j=Math.floor(i/3) * 3; j<i;j++){
					for(let x=0;x<3;x++) {
						for(let y =0; y<3;y++) hor_restricted_row[x].push(array[j][x][y]);
					}

				}
			const ver_restricted_row = [...Array(3)].map(e => Array());
			//i%3 => 0th or 1st or 2nd block
			for(let j = i%3; j<i;j+=3) {
				for(let k =0;k<3;k++){
						for(let x =0; x< 3;x++) ver_restricted_row[k].push(array[j][x][k])
					}

			}
			for(let j =0; j<3;j++){
				for(let x = 0;x<3;x++){
					//convert 2d array block to be 1d so that it could be searched (.includes) below. block.slice() create a copy of the original array
					const flat_block = [].concat.apply([],block.slice());

				    
					if(hor_restricted_row[0]!== undefined  && ver_restricted_row[0]!== undefined) 
						block[j][x] = random_assign(num_list.filter(i=>!hor_restricted_row[j].includes(i) && !ver_restricted_row[x].includes(i) && !flat_block.includes(i)))[0];

					else if(hor_restricted_row[0] !== undefined)
						block[j][x] =random_assign(num_list.filter(i=>!hor_restricted_row[j].includes(i) && !flat_block.includes(i)))[0];

					else if(ver_restricted_row[0]!== undefined)
						block[j][x] =random_assign(num_list.filter(i=>!flat_block.includes(i) && !ver_restricted_row[x].includes(i)))[0];

					else block[j][x] =random_assign(num_list.filter(i=>!flat_block.includes(i)))[0];
					
				}
			}
			if([].concat.apply([],block.slice()).includes(undefined)) {
				generate_numbers();
				return;
			}
			array.push(block);
	}
		

document.querySelectorAll("table").forEach((table,num_1)=>{
			table.querySelectorAll("tr").forEach((tr,num_2)=>{
				tr.querySelectorAll("td").forEach((td,num_3)=>{
					td.textContent = array[num_1][num_2][num_3];

				})

			})
		})

	}

	
	generate_numbers();


</script>
</body>
