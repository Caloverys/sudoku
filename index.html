
<!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">
<head>
<style>
	*{
		 -moz-user-select: none;
   -webkit-user-select: none;
   user-select: none;
	}

	:root{
		--cell_size:30px;
		--cell_border_size: 1px;

	}
	table{
		
		border-collapse: collapse;
		/* display three tables per row*/
		flex: 0 0 33.333333%;
		outline:2px solid black;
		outline-offset: -1.5px;
		padding:2px;


	}
	td{
		width:30px;
		border:var(--cell_border_size) solid black;

		height:30px;
		padding:0;
		text-align: center;
		font-size:calc(var(--cell_size) / 1.75);

	}

	#table_container{
		 display: inline-flex;
		flex-wrap: wrap;
		font-family: sans-serif;
		outline:2px solid black;
		/*1 is the border size for td)*/
		width:calc(calc(var(--cell_size) + var(--cell_border_size)) * 9);
		pos
	

	}
	.center{
		width:100%;
		display: flex;
  justify-content: center;
  position: fixed;
  top:20%;

	}
	
</style>



</head>
<body>
<div class='center'>
<div id='table_container'>

</div>
</div>
<script>
	const table_container = document.querySelector("#table_container");
	const cell_list = [];
	let new_arr = [];

	for(let i = 0; i<9;i++){
		let table = document.createElement("table");
		for(let j=0; j<3;j++){
			let tr = document.createElement("tr");
			for(let b = 0; b<3;b++){
				let td = document.createElement("td");
				tr.appendChild(td);
			}
			table.appendChild(tr)
		}
		table_container.appendChild(table);
	}
	const num_list =[1,2,3,4,5,6,7,8,9];
	function random_assign(arr){
		const new_arr = [];
		// can not directly modify arr because if will modify the original array (num_list)
		const duplicate_arr =JSON.parse(JSON.stringify(arr));
		while(duplicate_arr.length > 0){
			let random_num = Math.floor(Math.random() *  duplicate_arr.length)
			new_arr.push(duplicate_arr[random_num]);
			 duplicate_arr.splice(random_num,1);

		}
		return new_arr;

	}
	function generate_numbers(){
		let array = [];
		for(let i =0; i < 9;i++){
			console.log("new one")
				const block = [];



				const hor_restricted_row = [];
				//0th or 3rd or 6th block
				const leftmost_block = Math.floor(i/3) * 3;

				for(let j=leftmost_block; j<i;j++){
					for(let k =0;k<3;k++){
						//each block has a 3 * 3 structure
						const sub_row = [];
						for(let x =0; x< 3;x++){
							//console.log(x+3*k,i,j,array[j],array,leftmost_column)
							sub_row.push(array[j][x + 3 * k])

						}
						hor_restricted_row.push(sub_row);
					}

			}
			const ver_restricted_row = [];
			//0th or 1st or 2nd block
			const topmost_block = i%3;
			for(let j = topmost_block; j<i;j+=3) {
				for(let k =0;k<3;k++){
						const sub_row = [];
						for(let x =0; x< 3;x++){
							sub_row.push(array[j][x + 3 * k])
						}
						ver_restricted_row.push(sub_row);
					}

			}
			for(let j =0; j<3;j++){
				let sub_array = [];
				for(let x = 0;x<3;x++){
					//convert 2d array block to be 1d so that it could be searched (.includes) below. block.slice() create a copy of the original array
					const flat_block = [].concat.apply([],block.slice());
				
					if(hor_restricted_row.length > 0 && ver_restricted_row.length > 0) sub_array.push(random_assign(num_list.filter(i=>!hor_restricted_row[x].includes(i) && !ver_restricted_row[j].includes(i) && !flat_block.includes(i)))[0]);
					else if(hor_restricted_row.length > 0)
						sub_array.push(random_assign(num_list.filter(i=>!hor_restricted_row[x].includes(i) && !flat_block.includes(i)))[0]);
					else if(ver_restricted_row.length > 0)
						sub_array.push(random_assign(num_list.filter(i=>!flat_block.includes(i) && !ver_restricted_row[j].includes(i)))[0]);
					else sub_array.push(random_assign(num_list.filter(i=>!flat_block.includes(i)))[0]);

					console.log("subarray",sub_array)

					
				}
				block.push(sub_array)
				console.log("block:",block)
			}
			array.push(block)
			console.log(array)
			/*
			let new_arr = num_list.filter(i=>!hor_restricted_row.includes(i));

	while(random_assign(new_arr)){


		while(ran_arr.length >0){
			//get the current producing number in the rect
			let current_num = num_list.length- ran_arr.length;
			function check(num){
				if(num === undefined) return false;
				if(hor_restricted_row.length > 0){
					if(hor_restricted_row[Math.floor(current_num/3)].includes(num))
						return false;

				}
				if(top_restricted_row.length > 0){
					for(let i=0; i< top_restricted_row.length;i++){
					if(top_restricted_row[i][num%3] === num)
						return false;
				}
				}
				
				return true;
			}
			let index = 0 ;
			//debugger
			
			while(!check(ran_arr[index]) && index < 9){
				index++;
				
			}
			//console.log("yes")
			new_arr.push(ran_arr[index]);
			//console.log(duplicate_arr)
			ran_arr.splice(ran_arr.indexOf(ran_arr[index]),1);
			// console.log(ran_arr, new_arr)
			 //debugger

		}

		array.push(new_arr);

		}*/
	}
		

document.querySelectorAll("table").forEach((table,num_1)=>{
			table.querySelectorAll("td").forEach((td,num_2)=>{
				td.textContent = array[num_1][num_2];
			})
		})

	}

	
	generate_numbers();


</script>
</body>
